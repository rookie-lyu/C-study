[TOC]

##### 1.TCP/IP 参考模型

(1) 应用层： 对应 OSI 参考模型的高层， 为用户提供所需要各种服务， 例如： FTP、 Telnet、
DNS、 SMTP 等
(2) 传输层： 对应 OSI 参考模型的传输层， 为应用进程间提供端到端的逻辑通信， 保证了数
据包的顺序传送及数据的完整性。 该层定义了两个主要的协议： 传输控制协议（TCP）
和用户数据报协议（UCP） 。 TCP 协议提供的是一种可靠的、 面向连接的数据传输服务；
而 UDP 协议提供的则是不可靠的、 无连接的数据传输协议。
(3) 网际层： 对应于 OSI 参考模型的网络层， 为主机之间提供逻辑通信。 网络层重新赋予主
机一个 IP 地址来完成对主机的寻址， 它还负责数据包在多种网络中的路由。 该层有四
个主要协议： 网际协议（IP） 、 地址解析协议（ARP） 、 互联网组管理协议（IGMP） 和
互联网控制报文协议（ICMP） 。
(4) 网络接口层： 与 OSI 参考模型中的物理层和数据链路层相对应。 它负责监视数据在主机
和网络之间的交换。 事实上， TCP/IP 本身并未定义该层的协议， 而是由参与互连的各网
络使用自己的物理层和数据链路层协议， 然后与 TCP/IP 的网络接口层进行连接。  

##### 2.OSI 分层（7 层）

： 应用层、 表示层、 会话层、 传输层、 网络层、 数据链路层、 物理层
(1) 物理层： 物理层使设备之间能够接受和发送比特流。 物理层的主要任务就是确定与传输
媒体的接口有关的一些特性， 如机械特性、 电气特性、 功能特性和过程特性。
(2) 数据链路层： 数据链路层传送的协议数据单元是帧。 数据链路层的三个基本问题是： 封
装成帧， 透明传输和差错检测。
(3) 会话层： 会话层管理主机之间的会话进程， 即负责建立、 管理、 终止进程之间的会话。
会话层还利用在数据中插入检验点来实现数据的同步。
(4) 表示层： 表示层对上层数据或信息进行变换以保证一个主机应用层信息可以被另一个主
机所理解。 表示层数据包转换包括数据的加密、 压缩、 格式转换等。  

##### 3.常见应用层协议的端口号

（1） HTTP： TCP， 80
（2） HTTPs： TCP， 443
（3） FTP： 控制， TCP， 21； 默认数据： TCP 20
（4） Telnet TCP 23
（5） SMTP TCP 25
（6） DNS UDP 53
（7） DHCP UDP  

##### 4.三报文握手：

(1) 假定主机 A 运行的是 TCP 客户程序， 而 B 运行 TCB 服务器程序。 最初两端的 TCP 进程
都处于 CLOSED（关闭） 状态。
(2) 一开始， B 的 TCP 服务器进程先创建传输控制块 TCB， 准备接受客户进程的连接请求。
然后服务器进程就处于 LISTEN（收听） 状态， 等待客户的连接请求。 如有， 即做出响应。
(3) A 的 TCP 客户进程也是首先创建传输控制模块 TCB。 然后， 在打算进行 TCP 连接时， 向
B 发出连接请求报文段， 这时首部中的同步位 SYN=1， 同时选择一个初始序号 seq=x。
TCP 规定， SYN 报文段（即 SYN=1 的报文段） 不能携带数据， 但要消耗掉一个序号。 这
时， TCP 客户进程进入 SYN-SENT（同步已发送） 状态。
(4) B 收到连接请求报文段后， 如同意建立连接， 则向 A 发送确认。 在确认报文段中应把
SYN 位和 ACK 位都置为 1， 确认号是 ack=x+1， 同时也为自己选择一个初始序号 seq=y。
请注意， 这个报文段也不能携带数据， 但同样要消耗掉一个序号。 这时 TCP 服务器进
程进入 SYN-RCVD（同步收到） 状态。
(5) TCP 客户进程收到 B 的确认后， 还要向 B 给出确认。 确认报文段的 ACK 置 1， 确认号
ack=y+1， 而自己的序号 seq=x+1。 TCP 的标准规定， ACK 报文段可以携带数据。 但如果
不携带数据则不消耗序号， 在这种情况下， 下一个数据报文段的序号仍是 seq=x+1。 这
时， TCP 连接已经建立， A 进入 EATABLISHED（已建立连接） 状态。
当 B 收到 A 的确认后， 也进入 ESTABLISHED（已建立连接） 状态。  

##### 5.为什么 TCP 建立连接需要三次握手， 两次行不行

不行， 三次握手可以防止已失效的连接请求报文段突然又传送到了 B
考虑一种正常情况， A 发出连接请求， 但因连接请求报文丢失未收到确认。 于是 A 再重传一
次连接请求。 后来收到了确认， 建立了连接。 数据传输完毕， 就释放了连接。 A 共发送了两
个连接请求报文段， 其中第一个丢失， 第二个到达了 B， 没有“已失效的连接请求报文段” 。
现假定出现一种异常情况， 即 A 发出的第一个连接请求报文段并没有丢失， 而是在某些网
络结点产长时间滞留了， 以致延误到连接释放以后的某个时间才到达 B。 本来这是一个早已
失效的报文段。 但 B 收到此失效的连接请求报文段后， 就误认为是 A 又发出一次新的连接
请求。 于是就向 A 发出确认报文段， 同意建立连接。 假定不采用三报文握手， 那么只要 B
发出确认， 新的连接就建立了。
由于现在 A 并没有发出建立连接的请求， 因此不会理睬 B 的确认， 也不会向 B 发送数据。
但 B 却以为新的运输连接已经建立了， 并一直等待 A 发来数据。 B 的许多资源就这样白白浪
费了。
采用三报文握手的办法， 可以防止上述现象的发生。 例如在刚才的异常情况下， A 不会像 B
的确认发出确认。 B 由于收不到确认， 就知道 A 并没有要求建立连接。  

##### 6.三次握手过程中做了哪些准备工作

（1） 双方的初始序号（2） 窗口协商， 即双方的接受窗口的大小（3） 最大的报文段的长度
（在选项中协商  